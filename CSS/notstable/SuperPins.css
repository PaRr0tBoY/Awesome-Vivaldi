/*
  Note: Since nth-child() doesn't support CSS variable calculations,
  if you need different row limits, you'll need to manually modify the number in the selector.

  Formula: nth-child(n+X), where X = (rows × columns) + 1

  Examples:
  - 2 rows × 3 columns = 6 square buttons, apply normal style from the 7th: nth-child(n+7)
  - 3 rows × 3 columns = 9 square buttons, apply normal style from the 10th: nth-child(n+10)
  - 1 row × 4 columns = 4 square buttons, apply normal style from the 5th: nth-child(n+5)
*/

:root {
  --pinned-column-count: 3;
  --pinned-row-count: 3;
  --pinned-gap: 8px;
  /* --pinned-bg: var(--colorAccentBgAlphaHeavy, rgba(255, 255, 255, 0.1)); */
  --pinned-icon-size: 20px;
  --pinned-tab-height: 50px;
}

.resize{
  max-height: fit-content !important;
}

#tabs-container .tab-strip {
  display: grid !important;
  grid-template-columns: repeat(var(--pinned-column-count), minmax(0, 1fr));
  /* grid-template-columns: repeat(var(--pinned-column-count), 1fr); */
  grid-auto-rows: min-content;
  gap: var(--pinned-gap);
  justify-content: center !important;
  /* width: 95% !important; */
}

#tabs-container .tab-position.is-pinned {
  display: contents !important;
}

/* 基础方形按钮样式 - 应用到所有固定标签页 */
#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(-n + 9)
  .is-pinned
  .tab-wrapper {
  /* #tabs-container .tab-strip > span:has(.is-pinned) .is-pinned .tab-wrapper { */
  max-height: var(--pinned-tab-height) !important;
  min-height: var(--pinned-tab-height) !important;
  display: flex !important;
  justify-content: flex-start !important;
  align-items: center !important;
  background-color: var(--colorFgAlpha) !important;
  margin: 0 !important;
  padding: 0 !important;
}

#tabs-container .tab-strip > span:has(.is-pinned) .is-pinned .tab-wrapper .tab {
  width: 100% !important;
  height: 100% !important;
  max-height: unset !important;
}

.tab-wrapper,
.tab,
.tab-header {
  min-width: 0;
  box-sizing: border-box;
  /* container-type: inline-size;
  container-name: tab-header; */
  /*padding-left: 0 !important;*/
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned)
  .is-pinned
  .tab-wrapper
  .tab-header {
  justify-content: space-around !important;
  align-items: center !important;
  width: 100% !important;
  height: 100% !important;
  flex: auto !important;
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned)
  .is-pinned
  .tab-wrapper
  svg.svg-tab-stack {
  height: 100% !important;
  max-height: unset !important;
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(-n + 9)
  .is-pinned
  .favicon {
  width: var(--pinned-icon-size) !important;
  height: var(--pinned-icon-size) !important;
  margin: auto !important;
  justify-self: flex-start;
  transition: margin 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(-n + 9)
  .is-pinned
  .tab-wrapper:hover
  .favicon {
  margin: auto !important;
  transform: translateX(calc(-50% + 8px)) !important;
}

/* Peek Pinned Tabs Title */
#tabs-container .tab-strip > span:has(.is-pinned) .is-pinned .tab-wrapper {
  overflow: hidden;
  isolation: isolate;
  z-index: 1000000;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(-n + 9)
  .is-pinned
  .tab-wrapper:not(.active):hover {
  /* background-color: var(--colorAccentBgAlpha) !important; */
  background-color: var(--colorAccentBg, rgba(255, 255, 255, 0.2)) !important;
  overflow: hidden;
  position: relative !important;
  z-index: 100000000;

  /* 展开到整行宽度 */
  width: calc(
    var(--pinned-column-count) * 100% + (var(--pinned-column-count) - 1) *
      var(--pinned-gap)
  ) !important;
  min-height: calc(var(--pinned-tab-height) + var(--pinned-gap)) !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.8s;
}

/* left column */
#tabs-container
  .tab-strip
  > span:nth-child(3n + 1):nth-child(-n + 9):has(.is-pinned)
  .is-pinned
  .tab-wrapper:not(.active):hover {
  margin-left: 0 !important;
}

/* middle column */
#tabs-container
  .tab-strip
  > span:nth-child(3n + 2):nth-child(-n + 9):has(.is-pinned)
  .is-pinned
  .tab-wrapper:not(.active):hover {
  margin-left: calc(-100% - var(--pinned-gap)) !important;
}

/* right column */
#tabs-container
  .tab-strip
  > span:nth-child(3n):nth-child(-n + 9):has(.is-pinned)
  .is-pinned
  .tab-wrapper:not(.active):hover {
  margin-left: calc(-200% - 2 * var(--pinned-gap)) !important;
}

#tabs-container .tab-strip:has(> span:has(.is-pinned:nth-child(-n + 9) .tab-wrapper:hover))
  > span:has(.is-pinned:nth-child(-n + 9):not(:has(.tab-wrapper:hover))) {
  pointer-events: none;
}

/* Hide Pinned Tabs Title */
#tabs-container .tab-strip > span:has(.is-pinned):nth-child(-n+9) .is-pinned .title {
  opacity: 0 !important;
  max-width: 0 !important;
  transition:
    opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    max-width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned)
  .is-pinned
  .tab-wrapper:hover
  .title:nth-child(-n+9) {
  opacity: 1 !important;
  max-width: 100% !important;
}

/* ========================================== */
/* Stack-counter Auto Hide for Essential Tabs */
#tabs-container .tab-strip > span:has(.is-pinned):nth-child(-n+9) .is-pinned .stack-counter {
  /* display: none !important; */
  padding: 0 !important;
  margin: 0 !important;
  max-width: 0 !important;
  min-width: 0 !important;
  opacity: 0 !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(-n+9)
  .is-pinned
  .tab-wrapper:hover
  .stack-counter {
  display: flex !important;
  padding: 1px 4px !important;
  margin-right: 6px !important;
  max-width: auto !important;
  min-width: 1.5em !important;
  opacity: 1 !important;
}
/* ========================================== */
/* Close Button disabling for Essential Tabs */
#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(-n + 9)
  .is-pinned
  /*.tab:hover*/
  .close {
  display: none !important;
}
/* ========================================== */


#tabs-container
  .tab-strip
  > span:has(.is-pinned)
  .is-pinned.active
  .tab-wrapper {
  outline: 2px solid var(--colorAccentBg, #4a90e2);
}

/* ========================================== */
/* 当 --pinned-row-count: 2, --pinned-column-count: 3, 7th tabs and after is in regular style  */
#tabs-container .tab-strip > span:has(.is-pinned):nth-child(n + 10) .is-pinned {
  grid-column: 1 / span var(--pinned-column-count) !important;
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(n + 10)
  .is-pinned
  .tab-wrapper {
  grid-column: 1 / -1 !important;
  width: 100% !important;
  min-width: 0 !important;
  max-height: unset !important;
  min-height: unset !important;
  height: var(--Height) !important;
  background-color: transparent !important;
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(n + 10)
  .is-pinned
  .tab-wrapper:hover {
  width: 100% !important;
  margin-left: 0 !important;
  /* background-color: var(--colorBgDark) !important; */
}

/* @container tab-header (max-width: 100px){
  body:not(:has(:is(#panel_switch, .toolbar-editor, #tabs-tabbar-container .toolbar-tabbar-before .UrlBar-AddressField:focus-within)))
  #tabs-container:not(:hover)
    .tab-strip
    > span:has(.is-pinned):nth-child(n + 10)
    .is-pinned
    .title {
    opacity: 0 !important;
    max-width: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    transition:
      opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
      max-width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
      padding 0.3s cubic-bezier(0.4, 0, 0.2, 1),
      margin 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
}

#tabs-container:hover
  .tab-strip
  > span:has(.is-pinned):nth-child(n + 10)
  .is-pinned
  .title {
  opacity: 1 !important;
  max-width: 100% !important;
  padding-left: 4px;
  margin-right: 3px;
  transition:
    opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    max-width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    padding-left 0.3s cubic-bezier(0.4, 0, 0.2, 1),
    margin-right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
} */

#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(n + 10)
  .is-pinned
  .tab:hover
  .close {
  display: flex !important;
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(n + 10)
  .is-pinned
  .favicon {
  width: 16px !important;
  height: 16px !important;
  /* margin: 0 !important; */
  transform: none !important;
}

/* ========================================== */
/* Separator and Newtab occupy full width */
#tabs-container .tab-strip .separator,
#tabs-container .tab-strip .newtab {
  grid-column: 1 / -1 !important;
}

.tab-strip .separator,
.newtab {
  grid-column: 1 / span 1;
}

.tab-wrapper,
.tab-strip .separator {
  position: relative;
  transform: none;
}

.tab-strip .separator {
  align-items: center;
  margin-bottom: 0px;
}

.tab-strip .separator hr {
  margin: 0;
  width: 100%;
}

#tabs-container .tab-position:not(.is-pinned),
#tabs-container .tab-position:not(.is-pinned) .separator,
#tabs-container .tab-position:not(.is-pinned) .newtab {
  grid-column: 1 / span var(--pinned-column-count) !important;
  position: relative !important;
  transform: none !important;
}

#tabs-container .tab-position:not(.is-pinned) .tab-wrapper {
  grid-column: 1 / -1 !important;
  width: 100% !important;
  min-width: 0 !important;
}

#tabs-container .tab-position:not(.is-pinned) {
  display: contents !important;
}

#tabs-container
  .tab-strip
  > span:has(.is-pinned):nth-child(-n + 9)
  .is-pinned
  .tab-wrapper {
  background-color: var(--colorBg, rgba(255, 255, 255, 0.2)) !important;
  border: 1px solid var(--colorHighlightBgDark) !important;
}

body:not(:has(:is(.WorkspacePopup, #panel_switch, .toolbar-editor, .UrlBar-AddressField:focus-within))) #tabs-tabbar-container:hover #tabs-container:not(:hover) .tab-strip > span:has(.is-pinned):nth-child(-n + 9) .is-pinned .tab-wrapper {
    background-color: var(--colorBg, rgba(255, 255, 255, 0.2)) !important;
    border: 1px solid var(--colorHighlightBgDark) !important;
}
